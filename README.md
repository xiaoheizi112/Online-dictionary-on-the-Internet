# 网络在线词典项目

## 项目背景
在当今信息爆炸的时代，英语作为国际通用语言，在学习、工作和生活中扮演着越来越重要的角色。网络在线词典作为一种便捷的语言查询工具，能够帮助用户快速获取单词的释义和用法。本项目旨在开发一个基于客户端-服务器架构的网络在线词典系统，为用户提供高效、稳定的单词查询服务。

## 技术栈
- **编程语言**：C语言
- **数据库**：SQLite3（轻量级关系型数据库）
- **网络通信**：Socket API（实现TCP/IP通信）
- **并发处理**：Epoll（Linux高性能IO多路复用机制）
- **数据存储**：文本文件存储词典数据

## 实现功能
### 1. 用户管理
- **用户注册**：用户可以注册新账号，系统将用户名和密码存储在SQLite3数据库中
- **用户登录**：已注册用户可以通过用户名和密码登录系统

### 2. 单词查询
- 用户登录后可以查询单词释义
- 系统从本地词典文件(dict.txt)中搜索单词并返回其释义
- 支持连续查询多个单词

### 3. 历史记录
- 系统自动记录用户的查询历史，包括查询时间和查询的单词
- 用户可以查看自己的历史查询记录

### 4. 并发处理
- 服务器端采用Epoll机制，能够同时处理多个客户端的连接和请求

## 达到目的
- 提供简单易用的单词查询服务
- 实现用户认证和个性化查询历史记录
- 构建高效稳定的客户端-服务器通信模型
- 展示如何在C语言环境下实现网络应用程序和数据库操作

## 应用方向
- 教育领域：学生可以使用该词典查询单词，辅助英语学习
- 软件开发：作为学习网络编程和数据库操作的示例项目
- 个人日常使用：提供快速便捷的单词查询工具

## 项目亮点
1. **高性能**：使用Epoll实现高效的IO多路复用，支持多个客户端并发连接
2. **轻量级**：采用SQLite3作为数据库，无需额外的数据库服务器
3. **完整功能**：包含用户认证、单词查询和历史记录等完整功能链
4. **简洁界面**：客户端提供友好的菜单界面，操作简单直观
5. **模块化设计**：服务端和客户端代码结构清晰，易于维护和扩展

## 文件结构说明
- `server.c`：服务器主程序，包含主函数和连接处理逻辑
- `client.c`：客户端主程序，包含用户交互和请求发送逻辑
- `se.c`/`se.h`：服务器端功能函数和头文件，实现注册、登录、查询等核心功能
- `cl.c`/`cl.h`：客户端功能函数和头文件，实现用户界面和请求处理
- `dict.txt`：词典数据文件，包含单词和释义

## 使用说明
1. **编译程序**
   - 编译服务器端：`gcc server.c se.c -o server -lsqlite3`
   - 编译客户端：`gcc client.c cl.c -o client`
2. **启动服务器**：`./server <端口号>`，例如：`./server 8888`
3. **启动客户端**：`./client <端口号>`，例如：`./client 8888`
4. 按照菜单提示进行注册、登录、查询单词或查看历史记录操作

## 编译说明
本项目使用C语言开发，需要在支持C编译器的环境下编译。编译时需要注意以下几点：
- 需要安装SQLite3库，用于数据库操作
- 编译服务器端时需要链接SQLite3库
- 在Linux系统下编译，支持Epoll机制

## 注意事项
- 服务器程序和客户端程序需要在具有正确网络配置的环境下运行
- 确保dict.txt文件与服务器程序在同一目录下

## 编写项目时遇到的问题及解决方法

### 问题一：在服务器端如何通过代码编写执行SQL语句？
答：利用sprintf函数将SQL语句格式化后，通过sqlite3_exec函数执行，每次执行前必须memset清空SQL语句缓冲区，避免内存泄漏。

### 问题二：在服务端监听套接字sockfd和连接套接字acceptfd的区别？
答：监听套接字sockfd用于监听客户端的连接请求，而连接套接字acceptfd用于与已连接的客户端进行数据通信。监听套接字只需要绑定IP地址和端口号，而连接套接字需要在accept函数返回后获得。

### 问题三：如何利用epoll机制实现并发处理？
答：在服务端程序中，首先创建监听套接字sockfd并绑定IP地址和端口号，然后调用listen函数监听连接请求。接着，创建epoll实例epfd并将sockfd添加到epoll事件集合中。在主循环中，调用epoll_wait等待事件发生，当有事件发生时，通过accept函数接受连接请求，获得连接套接字acceptfd。然后，将acceptfd添加到epoll事件集合中，即可实现对多个客户端的并发处理。

### 问题四：在服务端如何向客户端传达查询结果？
答：在服务端程序中，当查询到单词的释义后，将结果封装到消息结构体中，设置type字段为查询结果类型（如Q），并将结果字符串拷贝到data字段中。然后，通过send函数将消息发送给客户端。客户端在接收消息后，根据type字段判断是否为查询结果类型，如果是，则解析data字段中的结果字符串，进行显示或其他处理。

### 问题五：在服务端由于while循环导致最后的清理资源一直不会被执行该如何解决？
答：在服务端程序中，清理资源（如关闭数据库连接、关闭监听套接字等）通常在主循环结束后执行。由于主循环是无限循环，这些清理代码实际上不会被执行。为了解决这个问题，可以在主循环中添加一个条件判断，当满足某个条件时（如收到客户端的退出消息），跳出主循环，从而触发资源清理。（代码未实现）


